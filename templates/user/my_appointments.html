{% extends "user/base.html" %}
{% block title %}Appointment History{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/my_appointments.css') }}">
{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="text-warning fw-bold mb-4">
       My Appointment 
    </h2>

    {% for b in bookings %}
    <div class="appointment-card mx-auto">

        <div class="appointment-flex">

            <!-- LEFT SIDE -->
            <div class="left-info">
                <h5 class="section-title">
                    <i class="fa-solid fa-user"></i> Client & Service Details
                </h5>

                <p><strong>Name:</strong> {{ b.client_name }}</p>
                <p><strong>Email:</strong> {{ b.client_email }}</p>
                <p><strong>Phone:</strong> {{ b.client_phone }}</p>

                <p class="mt-3"><strong>Service Type:</strong> {{ b.service_type }}</p>
                <p><strong>Services:</strong> {{ b.services | join(", ") }}</p>

                <p class="mt-3"><strong>Date:</strong> {{ b.booking_date }}</p>
                <p><strong>Slot:</strong> {{ b.booking_time }}</p>
            </div>

            <!-- RIGHT SIDE -->
            <div class="right-info">
                <h5 class="section-title">
                    <i class="fa-solid fa-credit-card"></i> Payment & Status
                </h5>

                <p><strong>Amount:</strong> ₹{{ b.total_amount }}</p>
                <p><strong>Payment Method:</strong> {{ b.payment_method or "Demo Payment" }}</p>
                <p><strong>Transaction ID:</strong> {{ b.transaction_id or "—" }}</p>

                <div class="status-box mt-3">
                    {% set pay_status = b.payment_status or 'PENDING' %}
                    <span class="badge
                        {% if pay_status == 'SUCCESS' %}status-success
                        {% elif pay_status == 'PENDING' %}status-pending
                        {% else %}status-failed{% endif %}
                    ">
                        Payment: {{ pay_status }}
                    </span>

                    {% set app_status = b.appointment_status or 'CONFIRMED' %}
                    <span class="badge
                        {% if app_status == 'CONFIRMED' %}status-confirmed
                        {% elif app_status == 'COMPLETED' %}status-completed
                        {% else %}status-cancelled{% endif %}
                    ">
                        Appointment: {{ app_status }}
                    </span>
                </div>

                <!-- ACTION BUTTONS -->
                <div class="action-buttons mt-4">
                    <a href="{{ url_for('book_again', booking_id=b.booking_id) }}" class="btn btn-outline-warning">
                        Book Again
                    </a>

                    {% if (b.payment_status or 'PENDING') == 'PENDING' %}
                       <a href="{{ url_for('payment_page', booking_id=b.booking_id) }}"
                            class="btn btn-warning">
                                 Pay Now
                         </a>


                    {% endif %}   
     
                   
                </div>

            </div>
        </div>
    </div>
    {% else %}
    <p class="text-muted text-center mt-5">
        No appointment history found.
    </p>
    {% endfor %}
</div>
{% endblock %}
